# BWF Forms

Sub project of the Business Workflow ecosystem. BWF Forms provides a plugin where users can create, modify and publish Dynamic Forms, which may later be reused by plugins inside **BWF Components**. 

The project has its own _urls.py_ config and should be included in the host Django project. 
### Models

**BWForm**
Stores the main information about a form and holds a reference to its active version via the attribute _version_id_.

**BWFFormVersion**
Stores a file that keeps the JSON-object generated by the form builder. Similar to **BWF Workflow** only one of the child versions of a form can have an _active_ state. 

This object should be retrieved by its _version_id_ attribute, to avoid confusions with the Form Id and Version Id, as they are only integers. 

### `env` 
In case you want to use the dev server files exposed, you can do so by setting the following `env` variables:
```
BWF_FORMS_USE_DEV = True # default is False
BWF_FORMS_DEV_URL = ''
```

And they can be used like this in the templates
```
{% if BWF_FORMS_USE_DEV %}
	<link rel="stylesheet" href="{{BWF_FORMS_DEV_URL}}/css/app.css" />
	<script src="{{BWF_FORMS_DEV_URL}}/js/app.js"></script>
{% else%}
	<link rel="stylesheet" href="/static/form_builder/css/app.css" />
	<script src="/static/form_builder/js/form-builder.js"></script>
{% endif %}
```
# Form Builder
Form builder is a jQuery plugin that has the capability of form edition using drag-n-drop tools, and also, it can render stored forms for the end users to fill in. It generates a JSON object that can be stored, transferred and rendered (by the same plugin).

Currently it supports several web input and layout elements, plus some more complex and flexible form options. Its toolbox offers most of the common input elements; dynamic multi-select options; some layout components, such as multi columns, containers, and free-html blocks; and data clusters that can have multiple records, like a table with different elements, or just group pieces of the form into sections.

#### Development
The form builder can be run on development mode, with a hot-reload module to make this process better. It relies on Webpack 5 devserver, and depending on the entry point, it can either render a form in its own address, or just generate the js and css files to be included into a host site. 

**Starting the dev server**
Open a terminal at the BWF Form root directory and navigate into the builder's directory at `bwf_forms/bwf_forms/frontend/form_builder/` 

Run `npm start` and it will open a tab in the browser. If the screen is blank, it is possible that it's serving just the plugin files (js and css) and they can be imported into a different webpage.  e.g

```
<link rel="stylesheet" href="/static/form_builder/css/app.css" />
<script src="/static/form_builder/js/form-builder.js"></script>
```

#### Building
Create the build files that will be served to the host apps. The outcome of this procedure will be a `js` and a `css` file.

Run `npm run production` 


### Using the form plugin
Once the plugin is registered within jQuery, you can initialize the plugin onto an element like: 
```
$("#form_approval").formBuilder({
              formData: form_definition || [],
              initialValue: {
                ...some_initial_value),
              },
              submissionData: {
                url: <string>,
                method: "POST",
                headers: <optional>,
                data: {
                  plugin_object_id: form_approval_id,
                  workflow_instance_id: workflow_instance_id,
                  component_instance_id: $("#component_instance_id").val(),
                },
              },
              onSuccess: (data) => {
                console.log("Form submitted successfully:", data);
              },
              onError: (error) => {
                alert("Error submitting form. Please try again.");
                console.error("Form submission error:", error);
              },
            });
```
 
 Lastly, run the building, or render command:
 - `$("#form_approval").formBuilder('build')`
 - `$("#form_approval").formBuilder('render')`
 